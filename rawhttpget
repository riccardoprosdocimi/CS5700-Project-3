#!/usr/bin/env python3

from IP import IPPacket
import socket

from TCP import TCPPacket


def main():
    ip_proto = socket.htons(0x0800)
    sock = socket.socket(socket.AF_PACKET, socket.SOCK_RAW, ip_proto)

    while True:
        raw_pkt, _ = sock.recvfrom(4096)
        ip_pkt = IPPacket.from_bytes(raw_pkt=raw_pkt)

        if ip_pkt.protocol == socket.IPPROTO_TCP:
            tcp_pkt = TCPPacket.from_bytes(ip_pkt, raw_tcp_pkt=ip_pkt.data)
            print(tcp_pkt)


if __name__ == "__main__":
    main()
